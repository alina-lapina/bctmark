- name: Install python3
  apt:
    name: python3

- name: Install pip
  apt:
    name: python3-pip

- name: Install web3 python client
  pip:
    name: web3
    executable: pip3

# change the path when time to refactor
- name: Copy account generation script
  copy:
    src: roles/ethereum/files/generate_accounts.py
    dest: /tmp/generate_accounts.py

- name: Generate accounts
  shell: python3 /tmp/generate_accounts.py
  register: account_addresses_list

- name: Verify account addresses list
  debug:
    msg: "{{ account_addresses_list.stdout_lines }}"

- name: Delete former chain spec file
  file: 
    path: /tmp/home/parity/chain.json
    state: absent

# change the path when time to refactor
- name: Put new chain spec file
  template:
    src: roles/ethereum/templates/chain.json.j2
    dest: /tmp/home/parity/chain.json
    owner: parity
    mode: u=rwx,g=rwx,o=rwx
  vars:
    add_accounts: true

- name: Restart parity service
  service: name=parity state=restarted